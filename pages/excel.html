<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Excel æ™ºèƒ½å¤„ç† - NodeXHS</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background: #f5f5f7; color: #1f2937; }
        .container { max-width: 960px; margin: 0 auto; padding: 24px; }
        .breadcrumb { font-size: 14px; margin-bottom: 12px; }
        .breadcrumb a { color: #2563eb; text-decoration: none; }
        h1 { font-size: 24px; margin-bottom: 8px; }
        p.desc { color: #6b7280; margin-bottom: 16px; }
        .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 20px; }
        .upload { border: 2px dashed #d1d5db; border-radius: 10px; padding: 22px; text-align: center; }
        .upload.dragover { border-color: #2563eb; background: #f3f6ff; }
        .actions { margin-top: 12px; display: flex; gap: 10px; justify-content: center; }
        .btn { padding: 10px 16px; border: none; background: #2563eb; color: #fff; border-radius: 8px; cursor: pointer; }
        .btn.secondary { background: #111827; }
        .status { margin-top: 12px; padding: 10px; border-radius: 8px; font-size: 14px; }
        .status.success { background: #ecfdf5; color: #065f46; border: 1px solid #a7f3d0; }
        .status.error { background: #fef2f2; color: #991b1b; border: 1px solid #fecaca; }
        .status.info { background: #eff6ff; color: #1e40af; border: 1px solid #bfdbfe; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="breadcrumb"><a href="/">â† è¿”å›é¦–é¡µ</a></div>
        <h1>Excel æ™ºèƒ½å¤„ç†</h1>
        <p class="desc">ä¸Šä¼  .xlsx æ–‡ä»¶</p>

        <div class="card">
            <div class="upload" id="excel-upload">
                <p>ğŸ“ å°† .xlsx æ‹–æ‹½åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                <input id="excel-file" type="file" accept=".xlsx" style="display:none;" />
                <div class="actions">
                    <button id="btn-excel" class="btn">ä¸Šä¼ å¹¶å¤„ç†</button>
                </div>
            </div>
            <div id="excel-status" class="status hidden"></div>
        </div>
    </div>

    <script>
        const $ = (id) => document.getElementById(id);
        const showStatus = (el, text, type) => { el.textContent = text; el.className = 'status ' + (type||'info'); };

        const area = $('excel-upload');
        const fileInput = $('excel-file');
        area.addEventListener('click', () => fileInput.click());
        area.addEventListener('dragover', (e) => { e.preventDefault(); area.classList.add('dragover'); });
        area.addEventListener('dragleave', () => area.classList.remove('dragover'));
        area.addEventListener('drop', (e) => { e.preventDefault(); area.classList.remove('dragover'); if (e.dataTransfer.files.length) { fileInput.files = e.dataTransfer.files; } });

        $('btn-excel').addEventListener('click', async () => {
            const f = fileInput.files[0];
            const statusEl = $('excel-status');
            if (!f) { showStatus(statusEl, 'âŒ è¯·å…ˆé€‰æ‹© .xlsx æ–‡ä»¶', 'error'); return; }
            if (!f.name.toLowerCase().endsWith('.xlsx')) { showStatus(statusEl, 'âŒ ä»…æ”¯æŒ .xlsx', 'error'); return; }
            showStatus(statusEl, 'ğŸ”„ å¤„ç†ä¸­...', 'info');
            try {
                const resp = await fetch('/api/excel', { method: 'POST', body: f });
                if (!resp.ok) { const t = await resp.text(); showStatus(statusEl, `âŒ å¤„ç†å¤±è´¥: ${resp.status} ${t}`, 'error'); return; }
                const blob = await resp.blob();
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a'); a.href = url; a.download = 'processed.xlsx'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
                showStatus(statusEl, 'âœ… å¤„ç†å®Œæˆï¼Œå·²å¼€å§‹ä¸‹è½½', 'success');
            } catch (e) {
                showStatus(statusEl, 'âŒ è¯·æ±‚å¤±è´¥: ' + (e && e.message ? e.message : e), 'error');
            }
        });
    </script>
</body>
</html>


